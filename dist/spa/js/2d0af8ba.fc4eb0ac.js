(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d0af8ba"],{"0f7e":function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.SHOW?r("q-page",{staticClass:"form-page justify-center",attrs:{padding:""}},[r("q-card",{staticClass:"q-ma-sm ",attrs:{inline:""}},[r("q-card-section",[r("form-header",{attrs:{title:t.FORM.title(),subtitle:t.FORM.subtitle()}},[r("template",{slot:"menu-item"},[t.$route.params.id?r("list-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:t.$tc("label.remove"),icon:"delete",clickable:""},on:{click:t.FORM.delete}}):t._e()],1)],2)],1),r("q-card-section",[r("div",{staticClass:"row q-gutter-sm q-gutter-x-lg q-mb-lg"},[r("div",{staticClass:"col-12 col-md-6"},[r("div",{staticClass:"row q-gutter-x-md q-mb-lg"},[r("q-field",{staticClass:"col-12",attrs:{icon:"code",error:t.errors.has("number"),"error-message":t.errors.first("number")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"edit"==t.$route.meta.mode?"required":"",expression:"$route.meta.mode == 'edit' ? 'required':''"}],attrs:{name:"number",label:"No Transaction",placeholder:"[Auto Generate]",autofocus:""},model:{value:t.rsForm.number,callback:function(e){t.$set(t.rsForm,"number",e)},expression:"rsForm.number"}})],1),r("q-field",{staticClass:"col-12",attrs:{icon:"account_box",error:t.errors.has("customer_id"),"error-message":t.errors.first("customer_id")}},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"customer_id",label:"Customer",disable:t.IssetIncomeItems,options:t.CustomerOptions,filter:"",clearable:""},on:{input:t.setCustomerReference},model:{value:t.rsForm.customer_id,callback:function(e){t.$set(t.rsForm,"customer_id",e)},expression:"rsForm.customer_id"}}),r("q-tooltip",{attrs:{disable:!t.IssetIncomeItems,offset:[0,10]}},[t._v("To change, Please clear Delivery items first!")])],1)],1)]),r("div",{staticClass:"col-12 col-md-6"},[r("div",{staticClass:"row q-gutter-x-md q-mb-lg"},[r("q-field",{staticClass:"col-12",attrs:{icon:"calendar_today",error:t.errors.has("begin_date"),"error-message":t.errors.first("begin_date")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"begin_date","stack-label":"",label:"Begin Date",type:"date"},model:{value:t.rsForm.begin_date,callback:function(e){t.$set(t.rsForm,"begin_date",e)},expression:"rsForm.begin_date"}})],1),r("q-field",{staticClass:"col-12",attrs:{icon:"calendar_today",error:t.errors.has("until_date"),"error-message":t.errors.first("until_date")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"until_date","stack-label":"",label:"Until Date",type:"date"},model:{value:t.rsForm.until_date,callback:function(e){t.$set(t.rsForm,"until_date",e)},expression:"rsForm.until_date"}})],1)],1)]),r("div",{staticClass:"col-12"},[r("q-table",{ref:"table",staticStyle:{"min-width":"100%","max-width":"100%",display:"inline-grid"},attrs:{color:"primary",data:t.rsForm.forecast_items,dense:"","rows-per-page-options":[0],columns:[{name:"prefix",label:"",align:"left"},{name:"item_id",label:"Item code",align:"left"},{name:"quantity",label:"Qty",align:"center",style:"width:100px"},{name:"unit_id",label:"Unit",align:"center",style:"width:100px"},{name:"price",label:"Price",align:"center",style:"width:150px"},{name:"total_price",label:"Total price",align:"center",style:"width:150px"}],pagination:{sortBy:null,descending:!1,page:null,rowsPerPage:0}},scopedSlots:t._u([{key:"body",fn:function(e){return[r("q-tr",{attrs:{props:e}},[r("q-td",{key:"prefix",staticStyle:{width:"50px"},attrs:{props:e}},[r("q-btn",{attrs:{dense:"",icon:"delete",color:"negative"},on:{click:function(r){return t.removeItem(e.row.__index)}}})],1),r("q-td",{key:"item_id",attrs:{props:e}},[r("q-field",{staticStyle:{"min-width":"150px"},attrs:{error:t.errors.has("item-"+(e.row.__index+1)),"error-message":t.errors.first("item-"+(e.row.__index+1))}},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-auto",attrs:{name:"item-"+(e.row.__index+1),inverted:"",color:"blue-grey-5",options:t.ItemOptions,filter:"",readonly:!t.IssetCustomerID},on:{input:function(r){t.setItemReference(e.row.__index,r)}},model:{value:e.row.item_id,callback:function(r){t.$set(e.row,"item_id",r)},expression:"props.row.item_id"}}),r("q-tooltip",{attrs:{disable:t.IssetCustomerID,offset:[0,10]}},[t._v("Select a customer, first! ")])],1)],1),r("q-td",{key:"quantity",attrs:{props:e}},[r("q-field",{staticStyle:{"min-width":"70px"},attrs:{error:t.errors.has("quantity-"+(e.row.__index+1))}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:e.row.item_id?"required":"",expression:"props.row.item_id ? 'required' : ''"}],attrs:{name:"quantity-"+(e.row.__index+1),type:"number",align:"center",inverted:"",color:"blue-grey-5"},model:{value:e.row.quantity,callback:function(r){t.$set(e.row,"quantity",r)},expression:"props.row.quantity"}})],1)],1),r("q-td",{key:"unit_id",attrs:{props:e}},[r("q-field",{staticStyle:{"min-width":"70px"},attrs:{error:t.errors.has("unit_id-"+(e.row.__index+1))}},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:e.row.item_id?"required":"",expression:"props.row.item_id ? 'required' : ''"}],attrs:{name:"unit_id-"+(e.row.__index+1),inverted:"",color:"blue-grey-5",options:t.ItemUnitOptions[e.row.__index]},on:{input:function(r){t.setUnitReference(e.row.__index,r)}},model:{value:e.row.unit_id,callback:function(r){t.$set(e.row,"unit_id",r)},expression:"props.row.unit_id"}})],1)],1),r("q-td",{key:"price",attrs:{props:e}},[r("q-field",{staticStyle:{"min-width":"120px"},attrs:{error:t.errors.has("price-"+(e.row.__index+1))}},[r("q-numeric",{directives:[{name:"validate",rawName:"v-validate",value:e.row.item_id?"required":"",expression:"props.row.item_id ? 'required' : ''"}],attrs:{name:"price-"+(e.row.__index+1),align:"right",inverted:"",color:"blue-grey-5"},model:{value:e.row.price,callback:function(r){t.$set(e.row,"price",r)},expression:"props.row.price"}})],1)],1),r("q-td",{key:"total_price",attrs:{props:e}},[r("q-field",{staticStyle:{"min-width":"150px"},attrs:{error:t.errors.has("total_price-"+(e.row.__index+1))}},[r("q-numeric",{attrs:{name:"total_price-"+(e.row.__index+1),align:"right",inverted:"",color:"blue-grey-5",readonly:"",value:e.row.quantity*e.row.price}})],1)],1)],1),r("q-tr",{staticClass:"bg-grey-3",attrs:{props:e}},[r("q-td"),r("q-td",[r("div",{staticClass:"text-left"},[r("table",{staticClass:"table-min full-width"},[r("tr",[r("td",[t._v("No Plate    ")]),r("td",[t._v(t._s(e.row.item.part_number))])]),r("tr",[r("td",[t._v("Plate name  ")]),r("td",[t._v(t._s(e.row.item.part_name))])])])])]),r("q-td",{attrs:{colspan:"2"}},[r("div",{staticClass:"text-left"},[r("table",{staticClass:"table-min full-width"},[r("tr",[r("td",[t._v("Quantity    ")]),r("td",[t._v(t._s(t.formatNumber(Number(e.row.quantity)*Number(e.row.unit_rate)))+" "+t._s(e.row.item.unit?e.row.item.unit.name:""))])]),r("tr",[r("td",[t._v("FG #alias    ")]),r("td",[t._v(t._s(e.row.item.part_alias||""))])])])])]),r("q-td",{attrs:{colspan:"100%"}},[r("q-input",{attrs:{"stack-label":"",label:"Note",color:"blue-grey-6"},model:{value:e.row.note,callback:function(r){t.$set(e.row,"note",r)},expression:"props.row.note"}})],1)],1)]}},{key:"bottom-row",fn:function(e){return r("q-tr",{attrs:{props:e}},[r("q-td",{attrs:{colspan:"100%"}},[r("strong",[r("q-btn",{attrs:{dense:"",icon:"add",color:"positive"},on:{click:function(e){return t.addNewItem()}}})],1)])],1)}}],null,!1,690963099)})],1),r("div",{staticClass:"col-12"},[r("div",{staticClass:"row q-gutter-x-lg q-mb-md"},[r("q-field",{staticClass:"col-12",attrs:{icon:"rate_review"}},[r("q-input",{attrs:{name:"description",type:"textarea",rows:"3","stack-label":"",label:"Description"},model:{value:t.rsForm.description,callback:function(e){t.$set(t.rsForm,"description",e)},expression:"rsForm.description"}})],1)],1)])])]),r("q-separator",{attrs:{dark:t.LAYOUT.isDark}}),r("q-card-actions",{staticClass:"q-mx-lg"},[r("q-btn",{attrs:{label:t.$tc("label.cancel"),icon:"cancel",color:"dark"},on:{click:function(e){return t.FORM.toBack()}}}),r("q-btn",{attrs:{label:t.$tc("label.reset"),icon:"refresh",color:"light"},on:{click:function(e){return t.setForm(t.FORM.data)}}}),r("q-btn",{attrs:{label:t.$tc("label.save"),icon:"save",color:"positive"},on:{click:function(e){return t.onSave()}}})],1)],1),r("q-inner-loading",{attrs:{visible:t.FORM.loading,dark:t.LAYOUT.isDark}},[r("q-spinner-dots",{attrs:{size:"70px",color:"primary"}})],1)],1):t._e()},s=[],a=(r("551c"),r("06db"),r("097d"),r("7f7f"),r("0ce1")),o={mixins:[a["a"]],data:function(){var t=this;return{SHEET:{customers:{data:[],api:"/api/v1/incomes/customers?mode=all"},transports:{data:[],api:"/api/v1/warehouses/transports?mode=all"},operators:{data:[],api:"/api/v1/references/operators?mode=all"},vehicles:{data:[],api:"/api/v1/references/vehicles?mode=all"},units:{data:[],api:"/api/v1/references/units?mode=all"},items:{data:[],api:"/api/v1/common/items?mode=all"}},FORM:{resource:{uri:"/admin/incomes/forecasts",api:"/api/v1/incomes/forecasts"}},rsForm:{},setDefault:function(){return{number:null,begin_date:t.$app.moment().startOf("month").format("YYYY-MM-DD"),until_date:t.$app.moment().endOf("month").format("YYYY-MM-DD"),customer_id:null,description:null,forecast_items:[{id:null,item_id:null,item:{},unit_id:null,unit:{},unit_rate:1,unit_amount:null,quantity:null,price:null,note:null}]}}}},created:function(){this.init()},computed:{IssetIncomeItems:function(){var t=this.rsForm.forecast_items;for(var e in t)if(t.hasOwnProperty(e)&&t[e].item_id)return!0;return!1},IssetCustomerID:function(){return!!this.rsForm.customer_id},CustomerOptions:function(){return this.SHEET.customers.data.map(function(t){return{label:[t.code,t.name].join(" - "),value:t.id}})||[]},TransportOptions:function(){return this.SHEET.transports.data.map(function(t){return{label:t.name,value:t.id}})||[]},OperatorOptions:function(){return this.SHEET.operators.data.map(function(t){return{label:t.name,value:t.id}})||[]},VehicleOptions:function(){return this.SHEET.vehicles.data.map(function(t){return{label:t.name,value:t.id}})||[]},UnitOptions:function(){return this.SHEET.units.data.map(function(t){return{label:t.code,value:t.id}})||[]},ItemOptions:function(){var t=this,e=this.SHEET.items.data.filter(function(e){return e.customer_id===t.rsForm.customer_id});return e.map(function(t){return{label:t.code,value:t.id}})||[]},ItemUnitOptions:function(){var t=this,e=[];for(var r in this.rsForm.forecast_items)this.rsForm.forecast_items.hasOwnProperty(r)&&function(){var i=t.rsForm.forecast_items[r];e[r]=t.UnitOptions||[],e[r]=e[r].filter(function(t){if(!i.item_id)return!1;if(i.item){if(i.item.unit_id===t.value)return!0;if(i.item.item_units){var e=i.item.item_units.filter(function(e){return e.unit_id==t.value});if(e.length>0)return!0}}return!1})}();return e},MAPINGKEY:function(){var t={customers:{},units:{},items:{}};return this.SHEET["customers"].data.map(function(e){t["customers"][e.id]=e}),this.SHEET["units"].data.map(function(e){t["units"][e.id]=e}),this.SHEET["items"].data.map(function(e){t["items"][e.id]=e}),t}},watch:{$route:"init"},methods:{init:function(){var t=this;this.SHOW=!1,this.FORM.load(function(e){t.setForm(e),setTimeout(function(){t.SHOW=!0},500)})},setCustomerReference:function(t){t?(this.rsForm.customer_name=this.MAPINGKEY["customers"][t].name,this.rsForm.customer_phone=this.MAPINGKEY["customers"][t].phone,this.rsForm.customer_address=this.MAPINGKEY["customers"][t].address_raw):(this.rsForm.customer_name=null,this.rsForm.customer_phone=null,this.rsForm.customer_address=null)},setItemReference:function(t,e){if(e){this.rsForm.forecast_items[t].item=this.MAPINGKEY["items"][e];var r=this.MAPINGKEY["items"][e].unit_id;this.rsForm.forecast_items[t].unit_id=r,this.rsForm.forecast_items[t].unit_rate=1,this.rsForm.forecast_items[t].unit=this.MAPINGKEY["units"][r],this.rsForm.forecast_items[t].price=this.MAPINGKEY["items"][e].price}else this.rsForm.forecast_items[t].unit_id=null,this.rsForm.forecast_items[t].unit={},this.rsForm.forecast_items[t].item={}},setUnitReference:function(t,e){var r=this;e&&(this.rsForm.forecast_items[t].item.unit_id===e?this.rsForm.forecast_items[t].unit_rate=1:this.rsForm.forecast_items[t].item.item_units&&this.rsForm.forecast_items[t].item.item_units.map(function(i){i.unit_id==e&&(r.rsForm.forecast_items[t].unit_rate=i.rate)}))},setForm:function(t){var e=this;this.rsForm=t,t.hasOwnProperty("has_relationship")&&t["has_relationship"].length>0&&(this.FORM.has_relationship=t.has_relationship,this.FORM.onRelationship({title:"Forecast has relation!",message:t["has_relationship"].join("-"),then:function(){return e.$router.push("".concat(e.FORM.resource.uri,"/").concat(t.id,"/view"))}}))},setRsForm:function(t){this.rsForm=t,this.rsForm.forecast_items||(this.rsForm.forecast_items=this.setDefault().forecast_items)},setRsData:function(t){this.FORM.data=JSON.parse(JSON.stringify(t)),this.FORM.data.forecast_items||(this.FORM.data.forecast_items=this.setDefault().forecast_items)},routing:function(){var t=this;if("edit"===this.$route.meta.mode){this.FORM.loading=!0;var e=this.FORM.resource.api+"/"+this.$route.params.id;this.$axios.get(e).then(function(e){var r=e.data;t.setRsForm(r),t.setRsData(r),t.setForm(r)}).catch(function(e){console.warn("[FORM:routing]",e),t.$app.response.error(e.response,"Load Form")}).finally(function(){t.FORM.show=!0,t.FORM.loading=!1})}else this.rsForm=this.setDefault(),this.FORM.show=!0},addNewItem:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t=this.setDefault().forecast_items[0];this.rsForm.forecast_items.push(t)},removeItem:function(t){this.rsForm.forecast_items.splice(t,1),this.rsForm.forecast_items.length<1&&this.addNewItem()},onSave:function(){var t=this;this.$validator.validate().then(function(e){if(e){t.FORM.loading=!0;var r=t.FORM.meta(),i=r.method,s=(r.mode,r.apiUrl);t.$axios.set(i,s,t.rsForm).then(function(e){var r=e.data.number+" - #"+e.data.id;t.FORM.response.success({message:r}),t.FORM.toView(e.data.id)}).catch(function(e){t.FORM.response.fields(e.response),t.FORM.response.error(e.response,"Submit")}).finally(function(){t.FORM.loading=!1})}else t.$q.notify({color:"negative",icon:"error",position:"top-right",timeout:3e3,message:"Please complete the form fields"})})}}},n=o,l=r("2877"),c=Object(l["a"])(n,i,s,!1,null,null,null);e["default"]=c.exports}}]);