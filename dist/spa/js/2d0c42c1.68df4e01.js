(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d0c42c1"],{"3a63":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.SHOW?i("q-page",{staticClass:"main-page row justify-center",attrs:{padding:""}},[i("q-card",{staticClass:"main-box self-start",attrs:{inline:""}},[i("q-card-section",[i("form-header",{attrs:{title:t.FORM.title(),subtitle:t.FORM.subtitle()}},[i("template",{slot:"menu-item"},[t.$route.params.id?i("list-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:t.$tc("label.remove"),icon:"delete",clickable:""},on:{click:t.FORM.delete}}):t._e()],1)],2)],1),i("q-card-section",[i("div",{staticClass:"row q-gutter-sm q-gutter-x-md"},[i("q-field",{staticClass:"col-12",attrs:{error:t.errors.has("customer_id"),"error-message":t.errors.first("customer_id")}},[i("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"customer_id","stack-label":"",label:"Customer",options:t.CustomerOptions,filter:"",clearable:""},on:{input:t.setCustomerReference},model:{value:t.rsForm.customer_id,callback:function(e){t.$set(t.rsForm,"customer_id",e)},expression:"rsForm.customer_id"}})],1),i("div",{staticClass:"col-12 q-my-md full-width-100"},[i("span",{staticClass:"hidden"},[t._v(t._s(t.MaxMount))]),i("q-table",{ref:"table",staticClass:"d-grid no-shadow",attrs:{data:t.rsForm.ship_delivery_items,dense:"","hide-bottom":"","rows-per-page-options":[0],columns:[{name:"prefix",label:"",align:"left"},{name:"item_id",label:"Part item",align:"left"},{name:"quantity",label:"Quantity",align:"center"},{name:"unit_id",label:"unit",align:"center"}],pagination:{rowsPerPage:0}},scopedSlots:t._u([{key:"body",fn:function(e){return[i("q-tr",{attrs:{propItem:e}},[i("q-td",{key:"prefix",staticStyle:{width:"50px"}}),i("q-td",{key:"item_id",attrs:{width:"50%"}},[i("q-field",{staticStyle:{"min-width":"150px"},attrs:{error:t.errors.has("ship_delivery_items."+e.row.__index+".item_id")}},[i("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"ship_delivery_items."+e.row.__index+".item_id",inverted:"",color:"blue-grey-5",options:t.ItemOptions,filter:"",readonly:""},model:{value:e.row.item_id,callback:function(i){t.$set(e.row,"item_id",i)},expression:"propItem.row.item_id"}}),i("q-tooltip",{attrs:{disable:t.IssetCustomerID,offset:[0,10]}},[t._v("Select a customer, first! ")])],1)],1),i("q-td",{key:"quantity",attrs:{width:"25%"}},[i("q-field",{staticStyle:{"min-width":"120px"},attrs:{error:t.errors.has("ship_delivery_items."+e.row.__index+".quantity")}},[i("q-input",{directives:[{name:"validate",rawName:"v-validate",value:t.FORM.validator.quantity(e.row,e.row.maximum),expression:"FORM.validator.quantity(propItem.row, propItem.row.maximum)"}],attrs:{name:"ship_delivery_items."+e.row.__index+".quantity",type:"number",align:"center",inverted:"",color:"blue-grey-5",suffix:e.row.item_id?"&nbsp;/&nbsp; "+e.row.maximum:""},model:{value:e.row.quantity,callback:function(i){t.$set(e.row,"quantity",i)},expression:"propItem.row.quantity"}})],1)],1),i("q-td",{key:"unit_id",attrs:{width:"20%"}},[i("q-field",{staticStyle:{"min-width":"100px"},attrs:{error:t.errors.has("ship_delivery_items."+e.row.__index+".unit_id")}},[i("q-select",{directives:[{name:"validate",rawName:"v-validate",value:e.row.item_id?"required":"",expression:"propItem.row.item_id ? 'required' : ''"}],attrs:{name:"ship_delivery_items."+e.row.__index+".unit_id",inverted:"",color:"blue-grey-5",options:t.ItemUnitOptions[e.row.__index]},on:{input:function(i){t.setUnitReference(e.row.__index,i)}},model:{value:e.row.unit_id,callback:function(i){t.$set(e.row,"unit_id",i)},expression:"propItem.row.unit_id"}})],1)],1)],1)]}},{key:"bottom-row",fn:function(e){return i("q-tr",{attrs:{scope:e}},[t.rsForm.ship_delivery_items&&0==t.rsForm.ship_delivery_items.length?i("q-td",{staticClass:"text-center",attrs:{colspan:"100%"}},[i("span",[t._v("No data")])]):t._e()],1)}}],null,!1,2914291978)})],1)],1)]),i("q-separator",{attrs:{dark:t.LAYOUT.isDark}}),i("q-card-actions",{staticClass:"q-mx-lg"},[i("q-btn",{attrs:{label:t.$tc("label.cancel"),icon:"cancel",color:"dark"},on:{click:function(e){return t.FORM.toBack()}}}),i("q-btn",{attrs:{label:t.$tc("label.reset"),icon:"refresh",color:"light"},on:{click:function(e){return t.setForm(t.FORM.data)}}}),i("q-btn",{attrs:{label:t.$tc("label.save"),icon:"save",color:"positive"},on:{click:function(e){return t.onSave()}}})],1)],1),i("q-inner-loading",{attrs:{visible:t.FORM.loading,dark:t.LAYOUT.isDark}},[i("q-spinner-dots",{attrs:{size:"70px",color:"primary"}})],1)],1):t._e()},s=[],n=(i("551c"),i("097d"),i("ac6a"),i("cadf"),i("06db"),i("456d"),i("c5f6"),i("7f7f"),i("0ce1")),a={mixins:[n["a"]],data:function(){var t=this;return{SHEET:{customers:{api:"/api/v1/incomes/customers?mode=all"},units:{api:"/api/v1/references/units?mode=all"},items:{api:"/api/v1/common/items?mode=all",autoload:!1}},FORM:{resource:{api:"/api/v1/incomes/ship-delivery-items",uri:"/admin/incomes/delivery/ship-delivery-items"},validator:{quantity:function(e,i){var r=[],s=t.$store.state.admin.CONFIG.model.pre_deliveries.max_quantity_validation;return e.item_id&&!0===s&&r.push("max_value:".concat(i)),r.join("|")}}},rsForm:{},setDefault:function(){return{customer_id:null,pre_delivery_id:null,ship_delivery_items:[]}}}},created:function(){this.init()},computed:{IssetIncomeItems:function(){var t=this.rsForm.ship_delivery_items;for(var e in t)if(t.hasOwnProperty(e)&&t[e].item_id)return!0;return!1},IssetCustomerID:function(){return!!this.rsForm.customer_id},CustomerOptions:function(){return this.SHEET.customers.data.map(function(t){return{label:[t.code,t.name].join(" - "),value:t.id}})||[]},TransportOptions:function(){return this.SHEET.vehicles.data.map(function(t){return{label:t.name,value:t.name}})},OperatorOptions:function(){return this.SHEET.operators.data.map(function(t){return{label:t.name,value:t.id}})||[]},VehicleOptions:function(){return this.SHEET.vehicles.data.map(function(t){return{label:t.name,value:t.id}})||[]},UnitOptions:function(){return this.SHEET.units.data.map(function(t){return{label:t.code,value:t.id}})||[]},ItemOptions:function(){var t=this,e=this.SHEET.items.data.filter(function(e){return e.customer_id===t.rsForm.customer_id});return e.map(function(t){return{label:"".concat(t.code," - ").concat(t.part_name),value:t.id}})||[]},ItemUnitOptions:function(){var t=this,e=[];for(var i in this.rsForm.ship_delivery_items)this.rsForm.ship_delivery_items.hasOwnProperty(i)&&function(){var r=t.rsForm.ship_delivery_items[i];e[i]=t.UnitOptions||[],e[i]=e[i].filter(function(t){if(!r.item_id)return!1;if(r.item){if(r.item.unit_id===t.value)return!0;if(r.item.item_units){var e=r.item.item_units.filter(function(e){return e.unit_id==t.value});if(e.length>0)return!0}}return!1})}();return e},MaxMount:function(){var t=this;if(!this.rsForm.customer_id||0==this.SHEET.items.data.length)return[];var e=[];return e.slice(),this.SHEET.items.data.map(function(i,r){i.customer_id===t.rsForm.customer_id&&Number(i.totals["PDO"])>0&&e.push({item_id:i.id,unit_id:i.unit_id,unit_rate:1,quantity:null,maximum:Number(i.totals["PDO"]),item:i})}),this.rsForm.ship_delivery_items=e,e},MAPINGKEY:function(){var t={customers:{},units:{},items:{}};return this.SHEET["customers"].data.map(function(e){t["customers"][e.id]=e}),this.SHEET["units"].data.map(function(e){t["units"][e.id]=e}),this.SHEET["items"].data.map(function(e){t["items"][e.id]=e}),t}},watch:{$route:"init"},methods:{init:function(){var t=this;this.SHOW=!1,this.FORM.load(function(e){t.setForm(e),setTimeout(function(){t.SHOW=!0},500)})},numUnitConvertion:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number(e)/Number(t.unit_rate||1)},onItemReference:function(){this.rsForm.customer_id||this.$q.notify("Select a customer !")},setCustomerReference:function(t){this.rsForm.customer_id?(this.rsForm.customer_name=this.MAPINGKEY["customers"][t].name,this.rsForm.customer_phone=this.MAPINGKEY["customers"][t].phone,this.rsForm.customer_address=this.MAPINGKEY["customers"][t].address_raw,this.SHEET.load("items","customer_id="+t),this.rsForm.ship_delivery_items=this.MaxMount):(this.rsForm.customer_name=null,this.rsForm.customer_phone=null,this.rsForm.customer_address=null)},setUnitReference:function(t,e){var i=this;e&&(this.rsForm.ship_delivery_items[t].item.unit_id===e?this.rsForm.ship_delivery_items[t].unit_rate=1:this.rsForm.ship_delivery_items[t].item.item_units&&this.rsForm.ship_delivery_items[t].item.item_units.map(function(r){r.unit_id==e&&(i.rsForm.ship_delivery_items[t].unit_rate=r.rate)}))},setForm:function(t){var e=this;this.rsForm=JSON.parse(JSON.stringify(t)),t.customer_id&&this.SHEET.load("items","customer_id="+t.customer_id),t.hasOwnProperty("has_relationship")&&Object.keys(t["has_relationship"]).length>0&&this.FORM.response.relationship({title:"Verify has relations!",messages:t["has_relationship"],then:function(){return e.$router.push("".concat(e.FORM.resource.uri,"/").concat(t.id))}})},addNewItem:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t=this.setDefault().ship_delivery_items[0];this.rsForm.ship_delivery_items.push(t)},removeItem:function(t){this.rsForm.ship_delivery_items.splice(t,1)},onSave:function(){var t=this;this.$validator.validate().then(function(e){if(e){if(0===t.rsForm.ship_delivery_items.reduce(function(t,e){return t+Number(e.quantity||0)},0))return console.warn("invalide!"),void t.$app.notify.error("Submit Invalid","Total must be grather than 0!");t.FORM.loading=!0;var i=t.FORM.meta(),r=i.method,s=(i.mode,i.apiUrl);t.$axios.set(r,s,t.rsForm).then(function(e){var i="The Items parts has been created!";t.FORM.response.success({message:i}),t.FORM.toIndex()}).catch(function(e){t.FORM.response.fields(e.response),t.FORM.response.error(e.response,"Submit")}).finally(function(){t.FORM.loading=!1})}else t.$q.notify({color:"negative",icon:"error",position:"top-right",timeout:3e3,message:"Please complete the form fields"})})}}},o=a,m=i("2877"),u=Object(m["a"])(o,r,s,!1,null,null,null);e["default"]=u.exports}}]);