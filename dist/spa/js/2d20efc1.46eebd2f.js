(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d20efc1"],{b261:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.SHOW?r("q-page",{staticClass:"form-page",attrs:{padding:""}},[r("q-card",{staticClass:"main-box",attrs:{inline:"",dark:e.LAYOUT.isDark}},[r("q-card-section",[r("form-header",{attrs:{title:e.FORM.title(),subtitle:e.FORM.subtitle()}},[r("template",{slot:"menu-item"},[e.$route.params.id?r("list-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:e.$tc("label.remove"),icon:"delete",clickable:""},on:{click:e.FORM.delete}}):e._e()],1)],2)],1),r("q-separator",{attrs:{dark:e.LAYOUT.isDark}}),r("q-card-section",{staticClass:"row q-col-gutter-sm"},["edit"!==this.$route.meta.mode?r("q-field",{staticClass:"col-12",attrs:{borderless:"",dense:"",prefix:"Transaction mode",error:e.errors.has("transaction")}},[r("q-option-group",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"transaction",type:"radio",inline:"",disable:"edit"==this.$route.meta.mode,options:[{label:"REGULER",value:"REGULER"},{label:"RETURN",value:"RETURN"}]},on:{input:function(t){return e.setTransactionReference(t)}},model:{value:e.rsForm.transaction,callback:function(t){e.$set(e.rsForm,"transaction",t)},expression:"rsForm.transaction"}})],1):e._e(),r("div",{staticClass:"col-12 col-md-6"},[r("div",{staticClass:"row q-col-gutter-x-sm"},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"edit"==e.$route.meta.mode?"required":"",expression:"$route.meta.mode == 'edit' ? 'required':''"}],staticClass:"col-12",attrs:{name:"number",label:e.$tc("label.number"),placeholder:"[Auto Generate]",error:e.errors.has("number"),"error-message":e.errors.first("number")},model:{value:e.rsForm.number,callback:function(t){e.$set(e.rsForm,"number",t)},expression:"rsForm.number"}}),r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-12",attrs:{name:"registration",label:e.$tc("incoming_goods.registration"),error:e.errors.has("registration"),"error-message":e.errors.first("registration")},model:{value:e.rsForm.registration,callback:function(t){e.$set(e.rsForm,"registration",t)},expression:"rsForm.registration"}}),r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required|date_format:YYYY-MM-DD|before:"+e.$app.moment().add(1,"days").format("YYYY-MM-DD"),expression:"'required|date_format:YYYY-MM-DD|before:'+$app.moment().add(1, 'days').format('YYYY-MM-DD')"}],staticClass:"col-12 col-md-8",attrs:{name:"date",type:"date",label:e.$tc("label.date"),"stack-label":"",error:e.errors.has("date"),"error-message":e.errors.first("date")},model:{value:e.rsForm.date,callback:function(t){e.$set(e.rsForm,"date",t)},expression:"rsForm.date"}}),r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-12 col-md-4",attrs:{name:"time",type:"time",label:e.$tc("label.time"),"stack-label":"",error:e.errors.has("time"),"error-message":e.errors.first("time")},model:{value:e.rsForm.time,callback:function(t){e.$set(e.rsForm,"time",t)},expression:"rsForm.time"}})],1)]),r("div",{staticClass:"col-12 col-md-6"},[r("div",{staticClass:"row q-col-gutter-x-sm"},[r("select-filter",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-12",attrs:{name:"customer",label:"Customer",disable:e.IssetItemDetails,options:e.CustomerOptions,filter:"",clearable:"",error:e.errors.has("customer"),"error-message":e.errors.first("customer")},on:{input:function(t){return e.setCustomerReference(t)}},model:{value:e.rsForm.customer_id,callback:function(t){e.$set(e.rsForm,"customer_id",t)},expression:"rsForm.customer_id"}}),r("q-tooltip",{attrs:{disable:!e.IssetItemDetails,offset:[0,10]}},[e._v("To change, Please delete Item goods first!")]),r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],staticClass:"col-12",attrs:{name:"reference_number","stack-label":"",label:"No. Ref.",error:e.errors.has("reference_number"),"error-message":e.errors.first("reference_number")},model:{value:e.rsForm.reference_number,callback:function(t){e.$set(e.rsForm,"reference_number",t)},expression:"rsForm.reference_number"}}),r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],staticClass:"col-12",attrs:{name:"reference_date",type:"date","stack-label":"",label:"Ref. Date",error:e.errors.has("reference_date"),"error-message":e.errors.first("reference_date")},model:{value:e.rsForm.reference_date,callback:function(t){e.$set(e.rsForm,"reference_date",t)},expression:"rsForm.reference_date"}})],1)])],1),r("q-card-section",{staticClass:"row q-col-gutter-sm"},[r("div",{staticClass:"col-12"},[r("div",{staticClass:"row q-col-gutter-x-sm q-mb-md"},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-12 col-md-4",attrs:{name:"order_mode",disable:"",radio:"",label:"Request orders mode",options:e.$store.state.admin.CONFIG.options.order_mode,error:e.errors.has("order_mode"),"error-message":e.errors.first("order_mode")},model:{value:e.rsForm.order_mode,callback:function(t){e.$set(e.rsForm,"order_mode",t)},expression:"rsForm.order_mode"}}),null!=e.rsForm.request_order_id?r("q-select",{staticClass:"col-12 col-md-8",attrs:{name:"request_order_id",label:"Request Orders",disable:"",clearable:"",options:e.RequestOrderOptions,error:e.errors.has("request_order_id"),"error-message":e.errors.first("request_order_id")},model:{value:e.rsForm.request_order_id,callback:function(t){e.$set(e.rsForm,"request_order_id",t)},expression:"rsForm.request_order_id"}}):e._e()],1)]),r("div",{staticClass:"col-12"},[r("q-table",{ref:"table",attrs:{color:"primary",data:e.rsForm.incoming_good_items,dense:"","rows-per-page-options":[0],columns:[{name:"prefix",label:"",align:"left"},{name:"item_id",label:"Item details",align:"left"},{name:"quantity",label:"Quantity",align:"center"},{name:"unit_id",label:"Unit",align:"center"}],pagination:{sortBy:null,descending:!1,page:null,rowsPerPage:0}},scopedSlots:e._u([{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t}},[r("q-td",{key:"prefix",staticStyle:{width:"50px"},attrs:{props:t}},[r("q-btn",{attrs:{dense:"",icon:"delete",color:"negative"},on:{click:function(r){return e.removeItem(t.row.__index)}}})],1),r("q-td",{key:"item_id",attrs:{props:t,width:"45%"}},[r("select-filter",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"items."+t.row.__index+".item_id",dense:"",outlined:"","hide-bottom-space":"",color:"blue-grey-5",options:e.ItemOptions,filter:"",readonly:!e.IssetCustomerID,error:e.errors.has("items."+t.row.__index+".item_id")},on:{input:function(r){e.setItemReference(t.row.__index,r)}},model:{value:t.row.item_id,callback:function(r){e.$set(t.row,"item_id",r)},expression:"props.row.item_id"}}),r("q-tooltip",{attrs:{disable:e.IssetCustomerID,offset:[0,10]}},[e._v("Select a customer, first! ")])],1),r("q-td",{key:"quantity",attrs:{props:t,width:"25%"}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:t.row.item_id?"required":"",expression:"props.row.item_id ? 'required' : ''"}],attrs:{name:"items."+t.row.__index+".quantity",type:"number",dense:"",outlined:"","hide-bottom-space":"",color:"blue-grey-5",error:e.errors.has("items."+t.row.__index+".quantity")},model:{value:t.row.quantity,callback:function(r){e.$set(t.row,"quantity",r)},expression:"props.row.quantity"}})],1),r("q-td",{key:"unit_id",attrs:{props:t,width:"25%"}},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:t.row.item_id?"required":"",expression:"props.row.item_id ? 'required' : ''"}],attrs:{name:"items."+t.row.__index+".unit_id",dense:"",outlined:"","hide-bottom-space":"",color:"blue-grey-5",options:e.ItemUnitOptions[t.row.__index],error:e.errors.has("items."+t.row.__index+".unit_id")},on:{input:function(r){e.setUnitReference(t.row.__index,r)}},model:{value:t.row.unit_id,callback:function(r){e.$set(t.row,"unit_id",r)},expression:"props.row.unit_id"}}),r("q-input",{staticClass:"hidden",model:{value:t.row.unit_rate,callback:function(r){e.$set(t.row,"unit_rate",r)},expression:"props.row.unit_rate"}})],1)],1),r("q-tr",{staticClass:"bg-grey-3",attrs:{props:t}},[r("q-td"),r("q-td",[r("div",{staticClass:"text-left"},[r("table",{staticClass:"table-min full-width"},[r("tr",[r("td",[e._v("No Plate    ")]),r("td",[e._v(e._s(t.row.item.part_number))])]),r("tr",[r("td",[e._v("Plate name  ")]),r("td",[e._v(e._s(t.row.item.part_name))])])])])]),r("q-td",{attrs:{colspan:"2"}},[r("div",{staticClass:"text-left"},[r("table",{staticClass:"table-min full-width"},[r("tr",[r("td",[e._v("Quantity    ")]),r("td",[e._v(e._s(e.formatNumber(Number(t.row.quantity)*Number(t.row.unit_rate)))+" "+e._s(t.row.item.unit?t.row.item.unit.name:""))])]),r("tr",[r("td",[e._v("FG #alias    ")]),r("td",[e._v(e._s(t.row.item.part_alias||""))])])])])])],1)]}},{key:"bottom-row",fn:function(t){return r("q-tr",{attrs:{props:t}},[r("q-td",{attrs:{colspan:"100%"}},[r("strong",[r("q-btn",{attrs:{dense:"",icon:"add",color:"positive"},on:{click:function(t){return e.addNewItem()}}})],1)])],1)}}],null,!1,3438311974)})],1),r("div",{staticClass:"col-12"},[r("div",{staticClass:"row q-col-gutter-x-md q-mb-md"},[r("q-input",{staticClass:"col-12 col-md-6",attrs:{name:"transport_number",label:"Transport number","stack-label":"",autocomplete:"off",error:e.errors.has("transport_number"),"error-message":e.errors.first("transport_number")},model:{value:e.rsForm.transport_number,callback:function(t){e.$set(e.rsForm,"transport_number",t)},expression:"rsForm.transport_number"}}),r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],staticClass:"col-12 col-md-6",attrs:{name:"transport_rate",type:"number",label:"Rate",error:e.errors.has("transport_rate"),"error-message":e.errors.first("transport_rate")},model:{value:e.rsForm.transport_rate,callback:function(t){e.$set(e.rsForm,"transport_rate",t)},expression:"rsForm.transport_rate"}}),r("q-input",{staticClass:"col-12",attrs:{name:"description",type:"textarea",rows:"3","stack-label":"",label:"Description"},model:{value:e.rsForm.description,callback:function(t){e.$set(e.rsForm,"description",t)},expression:"rsForm.description"}})],1)])]),r("q-separator",{attrs:{dark:e.LAYOUT.isDark}}),r("q-card-actions",{staticClass:"q-mx-lg"},[r("q-btn",{attrs:{label:e.$tc("label.cancel"),icon:"cancel",color:"dark"},on:{click:function(t){return e.FORM.toBack()}}}),r("q-btn",{attrs:{label:e.$tc("label.reset"),icon:"refresh",color:"light"},on:{click:function(t){return e.setForm(e.FORM.data)}}}),e.IS_EDITABLE?r("q-btn",{attrs:{label:e.$tc("label.save"),icon:"save",color:"positive"},on:{click:function(t){return e.onSave()}}}):e._e()],1)],1),r("q-inner-loading",{attrs:{visible:e.FORM.loading,dark:e.LAYOUT.isDark}},[r("q-spinner-dots",{attrs:{size:"70px",color:"primary"}})],1)],1):e._e()},i=[],o=(r("551c"),r("097d"),r("7f7f"),r("ac6a"),r("cadf"),r("06db"),r("456d"),r("0ce1")),a={mixins:[o["a"]],data:function(){var e=this;return{SHEET:{customers:{data:[],api:"/api/v1/incomes/customers?mode=all"},request_orders:{data:[],api:"/api/v1/incomes/request-orders?mode=detail-items&fields=customer_id,number"},brands:{data:[],api:"/api/v1/references/brands?mode=all"},units:{data:[],api:"/api/v1/references/units?mode=all"},vehicles:{data:[],api:"/api/v1/references/vehicles?mode=all"},items:{data:[],api:"/api/v1/common/items?mode=all"}},FORM:{resource:{uri:"/admin/warehouses/incoming-goods",api:"/api/v1/warehouses/incoming-goods"}},rsForm:{},setDefault:function(){return{number:null,date:e.$app.moment().format("YYYY-MM-DD"),time:e.$app.moment().format("HH:mm"),customer_id:null,reference_number:null,reference_date:null,transaction:null,order_mode:null,request_order_id:null,transport_number:null,tranport_rate:null,description:null,incoming_good_items:[{id:null,item_id:null,item:{},quantity:null,unit_id:null,unit_rate:1,request_order_id:null}]}}}},created:function(){this.init()},computed:{IS_EDITABLE:function(){return!(this.rsData.hasOwnProperty("has_relationship")&&Object.keys(this.rsData.has_relationship).length>0)},IssetItemDetails:function(){var e=this.rsForm.incoming_good_items;for(var t in e)if(e.hasOwnProperty(t)&&e[t].item_id)return!0;return!1},IssetCustomerID:function(){return!!this.rsForm.customer_id},CustomerOptions:function(){return this.SHEET.customers.data.map(function(e){return{label:[e.code,e.name].join(" - "),value:e.id}})||[]},RequestOrderOptions:function(){var e=this.rsForm.customer_id,t=this.SHEET.request_orders.data;return e&&(t=t.filter(function(t){return t.customer_id==e})),t.map(function(e){return{label:[e.number].join(" - "),value:e.id}})||[]},BrandOptions:function(){return this.SHEET.brands.data.map(function(e){return{label:e.name,value:e.id}})||[]},TransportOptions:function(){return this.SHEET.vehicles.data.map(function(e){return{label:e.name,value:e.name}})},UnitOptions:function(){return this.SHEET.units.data.map(function(e){return{label:e.code,value:e.id}})||[]},RequestOrderItemOptions:function(){var e=this;if("PO"===this.rsForm.order_mode){console.log("Filter in RequestOrder");var t=this.MAPINGKEY["request_orders"][this.rsForm.request_order_id]||{},r=t.request_order_items||[];return r.map(function(t){var r=e.MAPINGKEY["items"][t.item_id]||{},s=e.MAPINGKEY["units"][t.unit_id]||{};return{label:"[".concat(r.code,"] ").concat(r.part_name," (").concat(t.quantity," ").concat(s.code,") "),value:t.id}})||[]}return[]},ItemOptions:function(){var e=this,t=this.SHEET.items.data||[];return t=t.filter(function(t){return t.customer_id===e.rsForm.customer_id}),t.map(function(e){return{label:"[".concat(e.code,"] ").concat(e.part_name," - No.").concat(e.part_number),value:e.id}||[]})},ItemUnitOptions:function(){var e=this,t=[];for(var r in this.rsForm.incoming_good_items)this.rsForm.incoming_good_items.hasOwnProperty(r)&&function(){var s=e.rsForm.incoming_good_items[r];t[r]=e.UnitOptions||[],t[r]=t[r].filter(function(e){if(!s.item_id)return!1;if(s.item){if(s.item.unit_id===e.value)return!0;if(s.item.item_units){var t=s.item.item_units.filter(function(t){return t.unit_id==e.value});if(t.length>0)return!0}}return!1})}();return t},MAPINGKEY:function(){var e={customers:{},units:{},items:{},request_orders:{}};return this.SHEET["customers"].data.map(function(t){e["customers"][t.id]=t}),this.SHEET["units"].data.map(function(t){e["units"][t.id]=t}),this.SHEET["items"].data.map(function(t){e["items"][t.id]=t}),e}},watch:{$route:"init"},methods:{init:function(){var e=this;this.SHOW=!1,this.FORM.load(function(t){e.setForm(t),setTimeout(function(){e.SHOW=!0},500)})},setForm:function(e){var t=this;this.rsData=JSON.parse(JSON.stringify(e)),this.rsForm=JSON.parse(JSON.stringify(e)),e.hasOwnProperty("has_relationship")&&Object.keys(e["has_relationship"]).length>0&&this.FORM.response.relationship({title:"Incoming goods has relations!",messages:e["has_relationship"],then:function(){return t.$router.push("".concat(t.FORM.resource.uri,"/").concat(e.id))}})},setTransactionReference:function(e){if("RETURN"==e)return this.rsForm.order_mode="NONE",!1;"REGULER"==e&&this.rsForm.customer_id&&this.setCustomerReference(this.rsForm.customer_id)},setCustomerReference:function(e){if(e)if("RETURN"==this.rsForm.transaction)this.rsForm.order_mode="NONE";else{var t=this.MAPINGKEY["customers"][e];t&&(this.rsForm.order_mode=this.MAPINGKEY["customers"][e].order_mode)}else this.rsForm.order_mode=null},setItemReference:function(e,t){if(t){this.rsForm.incoming_good_items[e].item=this.MAPINGKEY["items"][t];var r=this.MAPINGKEY["items"][t].unit_id;this.rsForm.incoming_good_items[e].unit_id=r,this.rsForm.incoming_good_items[e].unit_rate=1,this.rsForm.incoming_good_items[e].unit=this.MAPINGKEY["units"][r]}else this.rsForm.incoming_good_items[e].unit_id=null,this.rsForm.incoming_good_items[e].unit_rate=1,this.rsForm.incoming_good_items[e].unit={},this.rsForm.incoming_good_items[e].item={}},setUnitReference:function(e,t){var r=this;t&&(this.rsForm.incoming_good_items[e].item.unit_id===t?this.rsForm.incoming_good_items[e].unit_rate=1:this.rsForm.incoming_good_items[e].item.item_units&&this.rsForm.incoming_good_items[e].item.item_units.map(function(s){s.unit_id==t&&(r.rsForm.incoming_good_items[e].unit_rate=s.rate)}))},addNewItem:function(e){e=e||!1;var t=this.setDefault().incoming_good_items[0];this.rsForm.incoming_good_items.push(t)},removeItem:function(e){this.rsForm.incoming_good_items.splice(e,1),this.rsForm.incoming_good_items.length<1&&this.addNewItem()},onSave:function(){var e=this;this.$validator.validate().then(function(t){if(t){e.FORM.loading=!0;var r=e.FORM.meta(),s=r.method,i=(r.mode,r.apiUrl);e.$axios.set(s,i,e.rsForm).then(function(t){var r=t.data.number+" - #"+t.data.id;e.FORM.response.success({message:r}),e.FORM.toView(t.data.id)}).catch(function(t){e.FORM.response.error(t.response,"UPDATE FAILED"),e.FORM.response.fields(t.response)}).finally(function(){e.FORM.loading=!1})}else e.$q.notify({color:"negative",icon:"error",position:"top-right",timeout:3e3,message:"Please complete the form fields"})})}}},n=a,l=r("2877"),m=Object(l["a"])(n,s,i,!1,null,null,null);t["default"]=m.exports}}]);