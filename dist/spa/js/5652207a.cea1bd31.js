(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["5652207a"],{"04ff":function(t,e,i){var r=i("5ca1"),a=i("3ca5");r(r.S+r.F*(Number.parseInt!=a),"Number",{parseInt:a})},"3ca5":function(t,e,i){var r=i("7726").parseInt,a=i("aa77").trim,s=i("fdef"),n=/^[-+]?0[xX]/;t.exports=8!==r(s+"08")||22!==r(s+"0x16")?function(t,e){var i=a(String(t),3);return r(i,e>>>0||(n.test(i)?16:10))}:r},c781:function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.SHOW?i("q-page",{staticClass:"form-page",attrs:{padding:""}},[i("q-card",{staticClass:"q-ma-sm ",attrs:{inline:""}},[i("q-card-section",[i("form-header",{attrs:{title:t.FORM.title(),subtitle:t.FORM.subtitle()}},[i("template",{slot:"menu-item"},[t.$route.params.id?i("list-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:t.$tc("label.remove"),icon:"delete",clickable:""},on:{click:t.FORM.delete}}):t._e()],1)],2)],1),i("q-card-section",{staticClass:"row q-col-gutter-sm"},[i("q-field",{staticClass:"col-12",attrs:{dense:"",borderless:"",prefix:"Work Time Process","label-width":"3",error:t.errors.has("worktime"),"error-message":t.errors.first("worktime")}},[i("q-option-group",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"worktime",type:"radio",inline:"",options:[{label:"Reguler",value:"REGULER"},{label:"Overtime",value:"OVERTIME",color:"secondary"}]},model:{value:t.rsForm.worktime,callback:function(e){t.$set(t.rsForm,"worktime",e)},expression:"rsForm.worktime"}})],1),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"row q-col-gutter-xs"},[i("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"edit"==t.$route.meta.mode?"required":"",expression:"$route.meta.mode == 'edit' ? 'required':''"}],staticClass:"col-12",attrs:{name:"number",placeholder:"[Auto Generate]",label:"No Transaction",autofocus:"",error:t.errors.has("number"),"error-message":t.errors.first("number")},model:{value:t.rsForm.number,callback:function(e){t.$set(t.rsForm,"number",e)},expression:"rsForm.number"}}),i("select-filter",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-12",attrs:{name:"customer_id",label:"Customer",disable:t.IssetItemID,options:t.CustomerOptions,filter:"",clearable:"",error:t.errors.has("customer_id"),"error-message":t.errors.first("customer_id")},on:{input:t.setCustomerReference},model:{value:t.rsForm.customer_id,callback:function(e){t.$set(t.rsForm,"customer_id",e)},expression:"rsForm.customer_id"}}),i("q-tooltip",{attrs:{disable:!t.IssetItemID,offset:[0,10]}},[t._v("Please remove Item Part, first! ")]),i("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-8",attrs:{name:"date",label:"Date",type:"date",error:t.errors.has("date"),"error-message":t.errors.first("date")},model:{value:t.rsForm.date,callback:function(e){t.$set(t.rsForm,"date",e)},expression:"rsForm.date"}}),i("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-4",attrs:{name:"time",label:"Time",type:"time",error:t.errors.has("time"),"error-message":t.errors.first("time")},model:{value:t.rsForm.time,callback:function(e){t.$set(t.rsForm,"time",e)},expression:"rsForm.time"}}),i("select-filter",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],staticClass:"col-12",attrs:{name:"operator_id",label:"Operator",error:t.errors.has("operator_id"),"error-message":t.errors.first("operator_id"),options:t.OperatorOptions,filter:"",clearable:""},model:{value:t.rsForm.operator_id,callback:function(e){t.$set(t.rsForm,"operator_id",e)},expression:"rsForm.operator_id"}})],1)]),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"row q-col-gutter-x-xs"},[i("select-filter",{staticClass:"col-12",attrs:{name:"packing_items.code",label:"Part Code",clearable:"",options:t.ItemOptions,error:t.errors.has("packing_items.code"),"error-message":t.errors.first("packing_items.code")},on:{input:t.setItemReference},model:{value:t.rsForm.packing_items.item_id,callback:function(e){t.$set(t.rsForm.packing_items,"item_id",e)},expression:"rsForm.packing_items.item_id"}}),i("select-filter",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],staticClass:"col-12",attrs:{name:"packing_items.work_order_item_id",label:"Part of Work Order",options:t.WorkOrderItemOptions,clearable:"",error:t.errors.has("packing_items.work_order_item_id"),"error-message":t.errors.first("packing_items.work_order_item_id")},on:{input:function(t){}},model:{value:t.rsForm.packing_items.work_order_item_id,callback:function(e){t.$set(t.rsForm.packing_items,"work_order_item_id",e)},expression:"rsForm.packing_items.work_order_item_id"}}),i("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-8",attrs:{name:"packing_items.quantity",type:"number",min:"0",label:"Quantity",suffix:t.rsForm.packing_items.item_id?"/ ("+t.MaxUnit+")":"",warning:t.rsForm.packing_items.quantity>t.getItemstock(t.rsForm.packing_items)&&"warning",error:!!(t.errors.has("packing_items.quantity")||t.rsForm.packing_items.quantity>t.MaxUnit)&&"error","error-message":t.errors.first("packing_items.quantity"),after:[{icon:"warning",warning:!0,handler:function(){}}]},model:{value:t.rsForm.packing_items.quantity,callback:function(e){t.$set(t.rsForm.packing_items,"quantity",e)},expression:"rsForm.packing_items.quantity"}}),i("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"col-4",attrs:{name:"packing_items.unit_id",label:"Unit",options:t.ItemUnitOptions,filter:"",error:t.errors.has("packing_items.unit_id"),"error-message":t.errors.first("packing_items.unit_id")},on:{input:t.setUnitReference},model:{value:t.rsForm.packing_items.unit_id,callback:function(e){t.$set(t.rsForm.packing_items,"unit_id",e)},expression:"rsForm.packing_items.unit_id"}})],1)]),i("div",{staticClass:"col-12"},[i("div",{staticClass:"row q-col-gutter-x-sm q-mb-lg"},[i("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"",expression:"''"}],staticClass:"col-12",attrs:{name:"type_fault_id",label:"Type of Faulty",disable:t.IssetItemFaults,options:t.TypeFaultOptions,error:t.errors.has("type_fault_id"),"error-message":t.errors.first("type_fault_id")},model:{value:t.rsForm.packing_items.type_fault_id,callback:function(e){t.$set(t.rsForm.packing_items,"type_fault_id",e)},expression:"rsForm.packing_items.type_fault_id"}}),i("div",{staticClass:"col-12"},[i("q-table",{staticClass:"d-grid full-width",attrs:{color:"primary",dense:"","hide-bottom":"",data:t.rsForm.packing_items.packing_item_faults,"rows-per-page-options":[0],columns:[{name:"prefix",label:"",align:"left",style:"width:50px"},{name:"quantity",label:"Quantity",align:"center",style:"width:120px"},{name:"fault_id",label:"Fault of Part",align:"left"}],pagination:{sortBy:null,descending:!1,page:null,rowsPerPage:0}},scopedSlots:t._u([{key:"body",fn:function(e){return i("q-tr",{attrs:{props:e}},[i("q-td",{key:"prefix",attrs:{props:e}},[i("q-btn",{attrs:{dense:"",icon:"delete",color:"negative"},on:{click:function(i){return t.removeItemFault(e.row.__index)}}})],1),i("q-td",{key:"quantity",attrs:{props:e}},[i("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"packing_items.packing_item_faults."+e.row.__index+".quantity",type:"number",min:"0",align:"center",outlined:"",dense:"","hide-bottom-space":"",color:"blue-grey",error:t.errors.has("packing_items.packing_item_faults."+e.row.__index+".quantity")},model:{value:e.row.quantity,callback:function(i){t.$set(e.row,"quantity",i)},expression:"props.row.quantity"}})],1),i("q-td",{key:"fault_id",attrs:{props:e}},[i("select-filter",{directives:[{name:"validate",rawName:"v-validate",value:e.row.quantity?"required":"",expression:"props.row.quantity ? 'required' : ''"}],staticStyle:{"min-width":"150px"},attrs:{name:"packing_items.packing_item_faults."+e.row.__index+".fault_id",outlined:"",dense:"","hide-bottom-space":"",color:"blue-grey",options:t.FaultOptions,filter:"",readonly:!t.IssetTypeFaultID||!t.IssetItemID,error:t.errors.has("packing_items.packing_item_faults."+e.row.__index+".fault_id")},model:{value:e.row.fault_id,callback:function(i){t.$set(e.row,"fault_id",i)},expression:"props.row.fault_id"}}),i("q-tooltip",{attrs:{disable:t.IssetItemID,offset:[0,20]}},[t._v("Please select The Item of Packing, first! ")]),i("q-tooltip",{attrs:{disable:t.IssetTypeFaultID,offset:[0,10]}},[t._v("Please select The Fault Type, first! ")])],1)],1)}},{key:"bottom-row",fn:function(e){return i("q-tr",{attrs:{props:e}},[i("q-td",{attrs:{colspan:"100%"}},[i("strong",[i("q-btn",{attrs:{dense:"",icon:"add",color:"positive"},on:{click:function(e){return t.addNewItemFault()}}})],1)])],1)}}],null,!1,3681539077)},[i("template",{slot:"top-left"})],2)],1)],1)]),i("div",{staticClass:"col-12"},[i("q-input",{staticClass:"col-12",attrs:{filled:"",name:"description",type:"textarea",rows:"3",label:"Description"},model:{value:t.rsForm.description,callback:function(e){t.$set(t.rsForm,"description",e)},expression:"rsForm.description"}})],1)],1),i("q-separator",{attrs:{dark:t.LAYOUT.isDark}}),i("q-card-actions",{staticClass:"q-mx-lg"},[i("q-btn",{attrs:{label:t.$tc("label.cancel"),icon:"cancel",color:"dark"},on:{click:function(e){return t.FORM.toBack()}}}),i("q-btn",{attrs:{label:t.$tc("label.reset"),icon:"refresh",color:"light"},on:{click:function(e){return t.setForm(t.FORM.data)}}}),i("q-btn",{attrs:{label:t.$tc("label.save"),icon:"save",color:"positive"},on:{click:function(e){return t.onSave()}}})],1)],1),i("q-inner-loading",{attrs:{visible:t.FORM.loading,dark:t.LAYOUT.isDark}},[i("q-spinner-dots",{attrs:{size:"70px",color:"primary"}})],1)],1):t._e()},a=[],s=(i("551c"),i("06db"),i("097d"),i("04ff"),i("c5f6"),i("7514"),i("7f7f"),i("0ce1")),n={mixins:[s["a"]],data:function(){var t=this;return{SETTING:{},SHEET:{shifts:{api:"/api/v1/references/shifts?mode=all"},faults:{api:"/api/v1/references/faults?mode=all"},units:{api:"/api/v1/references/units?mode=all"},type_faults:{api:"/api/v1/references/type_faults?mode=all"},customers:{api:"/api/v1/incomes/customers?mode=all"},operators:{api:"/api/v1/references/operators?mode=all"},items:{api:"/api/v1/common/items?mode=all",autoload:!1},itemstocks:{api:"/api/v1/common/items?mode=itemstock",autoload:!1},work_orders:{api:"/api/v1/factories/work-orders?mode=items",autoload:!1}},FORM:{resource:{uri:"/admin/factories/packings",api:"/api/v1/factories/packings"}},rsForm:{packing_items:{}},rsData:{},setDefault:function(){return{number:null,customer_id:null,date:t.$app.moment().format("YYYY-MM-DD"),time:t.$app.moment().format("HH:mm"),shift_id:null,worktime:"REGULER",description:null,operator_id:null,packing_items:{item_id:null,unit_id:null,unit_rate:1,item:{},unit:{},quantity:null,work_order_item_id:null,type_fault_id:null,packing_item_faults:[{id:null,fault_id:null,quantity:null}]}}}}},created:function(){this.init()},computed:{IssetItemFaults:function(){if(!this.rsForm.hasOwnProperty("packing_items"))return!1;var t=this.rsForm.packing_items.packing_item_faults;for(var e in t)if(t.hasOwnProperty(e)&&t[e].fault_id)return!0;return!1},IssetCustomerID:function(){return!!this.rsForm.customer_id},IssetItemID:function(){return!!this.rsForm.hasOwnProperty("packing_items")&&!!this.rsForm.packing_items.item_id},IssetTypeFaultID:function(){return!!this.rsForm.hasOwnProperty("packing_items")&&!!this.rsForm.packing_items.type_fault_id},TotalQtyFaulties:function(){if(!this.rsForm.hasOwnProperty("packing_items"))return!1;this.rsForm.packing_items.packing_item_faults.reduce(function(t,e){})},WorktimeOptions:function(){return[{label:"Reguler",value:"REGULER"},{label:"Overtime",value:"OVERTIME",color:"secondary"}]},WorkOrderItemOptions:function(){var t=this;if(!this.rsForm.customer_id)return[];if(0==this.SHEET.work_orders.data.length)return[];var e=[];return this.SHEET.work_orders.data.map(function(i){i.work_order_items.map(function(r){t.FORM.data.packing_items&&t.FORM.data.packing_items.work_order_item_id===r.id&&(r.total_packing_item-=t.FORM.data.packing_items.quantity*t.FORM.data.packing_items.unit_rate),r.item_id===t.rsForm.packing_items.item_id&&r.unit_amount>r.total_packing_item&&(r.work_order_number=i.number,e.push(r))})}),e.map(function(t){return{label:t.work_order_number,value:t.id,data:t,stamp:t.total_packing_item+"/"+t.unit_amount}})},OperatorOptions:function(){return this.SHEET.operators.data.map(function(t){return{label:t.name,value:t.id}})||[]},TypeFaultOptions:function(){return this.SHEET.type_faults.data.map(function(t){return{label:t.name,value:t.id}})||[]},FaultOptions:function(){var t=this;if(!this.rsForm.packing_items.type_fault_id)return[];var e=this.SHEET.faults.data;return e=e.filter(function(e){return e.type_fault_id===t.rsForm.packing_items.type_fault_id}),e.map(function(t){return{label:t.name,value:t.id}})||[]},ShiftOptions:function(){return this.SHEET.shifts.data.map(function(t){return{label:t.name,value:t.id}})||[]},CustomerOptions:function(){return this.SHEET.customers.data.map(function(t){return{label:[t.code,t.name].join(" - "),value:t.id}})||[]},UnitOptions:function(){return this.SHEET.units.data.map(function(t){return{label:t.code,value:t.id}})||[]},ItemOptions:function(){var t=this,e=this.SHEET.items.data.filter(function(e){return e.customer_id==t.rsForm.customer_id});return e.map(function(t){return{label:t.part_name+" NO."+t.part_number,sublabel:t.code,value:t.id,data:t}})||[]},ItemUnitOptions:function(){var t=[],e=this.rsForm.packing_items;return t=this.UnitOptions||[],t=t.filter(function(t){if(!e.item_id)return!1;if(e.item){if(e.item.unit_id===t.value)return!0;if(e.item.item_units){var i=e.item.item_units.filter(function(e){return e.unit_id===t.value});if(i.length>0)return!0}}return!1}),t},MaxUnit:function(){var t=this.rsForm.packing_items;if(!t.item_id)return 0;if(0==this.WorkOrderItemOptions.length)return 0;var e=this.WorkOrderItemOptions.find(function(e){return e.data.id===t.work_order_item_id});return console.log("rate",e.data.unit_rate),e?Number(e.data.unit_amount)-Number(e.data.total_packing_item):0},MAPINGKEY:function(){var t={work_orders:{},customers:{},units:{},items:{}};return this.SHEET["work_orders"].data.map(function(e){t["work_orders"][e.id]=e}),this.SHEET["customers"].data.map(function(e){t["customers"][e.id]=e}),this.SHEET["units"].data.map(function(e){t["units"][e.id]=e}),this.SHEET["items"].data.map(function(e){t["items"][e.id]=e}),t}},watch:{$route:"init"},methods:{init:function(){var t=this;this.SHOW=!1,this.FORM.load(function(e){t.setForm(e),setTimeout(function(){t.SHOW=!0},500)})},setForm:function(t){var e=this;this.rsForm=t,t.customer_id&&this.SHEET.load("items","customer_id="+t.customer_id),t.packing_items.item_id&&this.SHEET.load("work_orders","item_id="+t.packing_items.item_id),t.hasOwnProperty("has_relationship")&&t["has_relationship"].length>0&&(this.FORM.has_relationship=t.has_relationship,this.FORM.onRelationship({title:"Request order has relation!",message:t["has_relationship"].join("-"),then:function(){return e.$router.push("".concat(e.FORM.resource.uri,"/").concat(t.id,"/view"))}}))},getItemstock:function(t){if(t.item_id){var e=0,i=this.SHEET["itemstocks"].data.find(function(e){return e.id===t.item_id});i&&i.hasOwnProperty("totals")&&(t.unit_rate&&1!=t.unit_rate?e+=Number(i.totals["WO"])*Number(t.unit_rate):e+=Number(i.totals["WO"]));var r=this.FORM.data.packing_items;return r&&r.hasOwnProperty("quantity")&&r.hasOwnProperty("item_id")&&r.quantity&&r.item_id&&r.item_id===t.item_id&&(r.unit_rate&&1!=r.unit_rate?e+=Number(r.quantity)*Number(t.unit_rate):e+=Number(r.quantity)),e}},getTotalHanger:function(t,e,i){if(t>0&&e>0){var r=Number(t)%Number(e),a=Number(t)/Number(e);return Number.parseInt(a)+(r>0?" + ("+r+" "+i+")":"")}},setCustomerReference:function(t){t?this.SHEET.load("items","customer_id="+t):this.rsForm.packing_items.item_id=null},setItemReference:function(t){if(t){var e=this.MAPINGKEY["items"][t].unit_id;this.rsForm.packing_items.unit_id=e,this.rsForm.packing_items.unit_rate=1,this.rsForm.packing_items.item=this.MAPINGKEY["items"][t],this.rsForm.packing_items.unit=this.MAPINGKEY["units"][e],this.rsForm.packing_items.work_order_item_id=null,this.SHEET.load("work_orders","item_id="+t)}else this.rsForm.packing_items.unit_id=null,this.rsForm.packing_items.unit={},this.rsForm.packing_items.item={}},setUnitReference:function(t){var e=this;t&&(this.rsForm.packing_items.item.unit_id===t?this.rsForm.packing_items.unit_rate=1:this.rsForm.packing_items.item.item_units&&this.rsForm.packing_items.item.item_units.map(function(i){i.unit_id==t&&(e.rsForm.packing_items.unit_rate=i.rate)}))},addNewItemFault:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var t=this.setDefault().packing_items.packing_item_faults[0];this.rsForm.packing_items.packing_item_faults.push(t)},removeItemFault:function(t){this.rsForm.packing_items.packing_item_faults.splice(t,1),this.rsForm.packing_items.packing_item_faults.length<1&&this.addNewItemFault()},onSave:function(){var t=this;this.$validator.validate().then(function(e){if(e){t.FORM.loading=!0;var i=t.FORM.meta(),r=i.method,a=(i.mode,i.apiUrl);t.$axios.set(r,a,t.rsForm).then(function(e){var i=e.data.number+" - #"+e.data.id;t.FORM.response.success({message:i}),t.FORM.toView(e.data.id)}).catch(function(e){t.FORM.response.fields(e.response),t.FORM.response.error(e.response,"Submit")}).finally(function(){t.FORM.loading=!1})}else t.$q.notify({color:"negative",icon:"error",position:"top-right",timeout:3e3,message:"Please complete the form fields"})})}}},o=n,l=i("2877"),m=Object(l["a"])(o,r,a,!1,null,null,null);e["default"]=m.exports}}]);