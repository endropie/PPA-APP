(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d21e535"],{d4a0:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.SHOW?r("q-page",{staticClass:"main-page justify-center",attrs:{padding:""}},[r("q-card",{staticClass:"main-box",attrs:{inline:"",dark:e.LAYOUT.isDark}},[r("q-card-section",[r("form-header",{attrs:{title:e.FORM.title(),subtitle:e.FORM.subtitle()}},[r("template",{slot:"menu-prepend"},[e.rsForm.order_mode?r("q-chip",{attrs:{tag:"",small:"",color:"warning"}},[e._v(e._s(e.rsForm.order_mode))]):e._e()],1),r("template",{slot:"menu-item"},[e.$route.params.id?r("list-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:e.$tc("label.remove"),icon:"delete",clickable:""},on:{click:e.FORM.delete}}):e._e()],1)],2)],1),r("q-card-section",[r("div",{staticClass:"row q-gutter-sm q-gutter-x-md"},[r("div",{staticClass:"col-12 col-md-6"},[r("div",{staticClass:"row q-gutter-x-sm"},[r("q-field",{staticClass:"col-12",attrs:{error:e.errors.has("number"),"error-message":e.errors.first("number")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"edit"==e.$route.meta.mode?"required":"",expression:"$route.meta.mode == 'edit' ? 'required':''"}],attrs:{name:"number",label:"No Transaction",placeholder:"[Auto Generate]",dark:e.LAYOUT.isDark},model:{value:e.rsForm.number,callback:function(t){e.$set(e.rsForm,"number",t)},expression:"rsForm.number"}})],1),r("q-field",{staticClass:"col-12",attrs:{error:e.errors.has("date"),"error-message":e.errors.first("date")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"date","stack-label":"",label:"Date",type:"date",dark:e.LAYOUT.isDark},model:{value:e.rsForm.date,callback:function(t){e.$set(e.rsForm,"date",t)},expression:"rsForm.date"}})],1)],1)]),r("div",{staticClass:"col-12 col-md-6"},[r("div",{staticClass:"row q-gutter-x-sm"},[r("q-field",{staticClass:"col-12",attrs:{error:e.errors.has("customer"),"error-message":e.errors.first("customer")}},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"customer",label:"Customer",disable:e.IssetItemDetails,options:e.CustomerOptions,filter:"",clearable:"",dark:e.LAYOUT.isDark},on:{input:function(t){e.setCustomerReference(t)}},model:{value:e.rsForm.customer_id,callback:function(t){e.$set(e.rsForm,"customer_id",t)},expression:"rsForm.customer_id"}}),r("q-tooltip",{attrs:{disable:!e.IssetItemDetails,offset:[0,10]}},[e._v("To change: Please delete Detail items first!")])],1),r("q-field",{staticClass:"col-12",attrs:{error:e.errors.has("reference_number"),"error-message":e.errors.first("reference_number")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"PO"===e.rsForm.order_mode?"required":"",expression:"rsForm.order_mode === 'PO' ? 'required' :''"}],attrs:{name:"reference_number","stack-label":"",label:"PO / Qoutation / Memo",dark:e.LAYOUT.isDark},model:{value:e.rsForm.reference_number,callback:function(t){e.$set(e.rsForm,"reference_number",t)},expression:"rsForm.reference_number"}})],1)],1)]),r("div",{staticClass:"col-12"},[r("div",{staticClass:"row q-gutter-x-md"},["PO"!==e.rsForm.order_mode?r("q-field",{staticClass:"col-6 col-sm-6",attrs:{error:e.errors.has("begin-date"),"error-message":e.errors.first("begin-date")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"begin-date","stack-label":"",label:"Begin date",type:"date",dark:e.LAYOUT.isDark},model:{value:e.rsForm.begin_date,callback:function(t){e.$set(e.rsForm,"begin_date",t)},expression:"rsForm.begin_date"}})],1):e._e(),"PO"!==e.rsForm.order_mode?r("q-field",{staticClass:"col-6 col-sm-6",attrs:{error:e.errors.has("until-date"),"error-message":e.errors.first("until-date")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"until-date","stack-label":"",label:"Until date",type:"date",dark:e.LAYOUT.isDark},model:{value:e.rsForm.until_date,callback:function(t){e.$set(e.rsForm,"until_date",t)},expression:"rsForm.until_date"}})],1):e._e()],1)]),r("div",{staticClass:"col-12 q-my-md"},[r("q-table",{ref:"table",staticClass:"table-form full-width d-grid",attrs:{color:"primary",data:e.rsForm.request_order_items,dense:"",grid:"",dark:e.LAYOUT.isDark,"rows-per-page-options":[0],columns:[{name:"prefix",label:"",align:"left"},{name:"item_id",label:"Part item",align:"left"},{name:"quantity",label:"Qty",align:"center"},{name:"unit_id",label:"Unit",align:"center"},{name:"price",label:"Price",align:"center"},{name:"total",label:"Total",align:"center"}],pagination:{sortBy:null,descending:!1,page:null,rowsPerPage:0}},scopedSlots:e._u([{key:"body",fn:function(t){return[r("q-tr",{attrs:{props:t}},[r("q-td",{key:"prefix",staticStyle:{width:"50px"},attrs:{props:t}},[r("q-btn",{attrs:{dense:"",icon:"delete",color:"blue-grey-5"},on:{click:function(r){return e.removeItem(t.row.__index)}}})],1),r("q-td",{key:"item_id",attrs:{props:t,width:"30%"}},[r("q-field",{attrs:{error:e.errors.has("item-"+(t.row.__index+1))}},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"item-"+(t.row.__index+1),readonly:!e.IssetCustomerID,inverted:"",color:"blue-grey-5",dark:e.LAYOUT.isDark,options:e.ItemOptions,filter:""},on:{input:function(r){e.setItemReference(t.row.__index,r)}},model:{value:t.row.item_id,callback:function(r){e.$set(t.row,"item_id",r)},expression:"props.row.item_id"}}),r("q-tooltip",{attrs:{disable:e.IssetCustomerID,offset:[0,10]}},[e._v("Select a customer, first! ")])],1)],1),r("q-td",{key:"quantity",attrs:{props:t,width:"15%"}},[r("q-field",{attrs:{error:e.errors.has("quantity-"+(t.row.__index+1))}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:t.row.item_id?"required":"",expression:"props.row.item_id ? 'required' : ''"}],attrs:{name:"quantity-"+(t.row.__index+1),type:"number",align:"center",inverted:"",color:"blue-grey-5"},model:{value:t.row.quantity,callback:function(r){e.$set(t.row,"quantity",r)},expression:"props.row.quantity"}})],1)],1),r("q-td",{key:"unit_id",attrs:{props:t,width:"15%"}},[r("q-field",{attrs:{error:e.errors.has("unit-"+(t.row.__index+1))}},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:t.row.item_id?"required":"",expression:"props.row.item_id ? 'required' : ''"}],attrs:{name:"unit-"+(t.row.__index+1),inverted:"",color:"blue-grey-5",options:e.ItemUnitOptions[t.row.__index]},on:{input:function(r){e.setUnitReference(t.row.__index,r)}},model:{value:t.row.unit_id,callback:function(r){e.$set(t.row,"unit_id",r)},expression:"props.row.unit_id"}})],1),r("q-input",{staticClass:"hidden",model:{value:t.row.unit_rate,callback:function(r){e.$set(t.row,"unit_rate",r)},expression:"props.row.unit_rate"}})],1),r("q-td",{key:"price",staticStyle:{"min-width":"120px"},attrs:{props:t,width:"20%"}},[r("q-field",{attrs:{error:e.errors.has("price-"+(t.row.__index+1))}},[r("q-numeric",{directives:[{name:"validate",rawName:"v-validate",value:t.row.item_id?"required":"",expression:"props.row.item_id ? 'required' : ''"}],attrs:{name:"price-"+(t.row.__index+1),type:"number",align:"right",inverted:"",color:"blue-grey-5"},model:{value:t.row.price,callback:function(r){e.$set(t.row,"price",r)},expression:"props.row.price"}})],1)],1),r("q-td",{key:"total",staticStyle:{"min-width":"150px"},attrs:{props:t,width:"20%"}},[r("q-field",{attrs:{error:e.errors.has("total-"+(t.row.__index+1))}},[r("q-numeric",{directives:[{name:"validate",rawName:"v-validate",value:(t.row.item_id,""),expression:"props.row.item_id ? '' : ''"}],attrs:{name:"total-"+(t.row.__index+1),value:Number(t.row.quantity)*Number(t.row.price),align:"right",inverted:"",color:"blue-grey-5"}})],1)],1)],1),r("q-tr",{attrs:{props:t}},[r("q-td"),r("q-td",[r("div",{staticClass:"text-left"},[r("table",{staticClass:"table-description full-width"},[r("tr",[r("td",[e._v("No Plate    ")]),r("td",[e._v(e._s(t.row.item.part_number))])]),r("tr",[r("td",[e._v("Plate name  ")]),r("td",[e._v(e._s(t.row.item.part_name))])])])])]),r("q-td",{attrs:{colspan:"2"}},[r("div",{staticClass:"text-left"},[r("table",{staticClass:"table-description full-width"},[r("tr",[r("td",[e._v("Quantity    ")]),r("td",[e._v(e._s(e.formatNumber(Number(t.row.quantity)*Number(t.row.unit_rate)))+" "+e._s(t.row.item.unit?t.row.item.unit.name:""))])]),r("tr",[r("td",[e._v("FG #alias    ")]),r("td",[e._v(e._s(t.row.item.part_alias||""))])])])])]),r("q-td",{attrs:{colspan:"100%"}})],1)]}},{key:"bottom-row",fn:function(t){return r("q-tr",{attrs:{props:t}},[r("q-td",{attrs:{colspan:"100%"}},[r("strong",[r("q-btn",{attrs:{dense:"",icon:"add",color:"positive"},on:{click:function(t){return e.addNewItem()}}})],1)])],1)}}],null,!1,540672116)})],1),r("div",{staticClass:"col-12"},[r("div",{staticClass:"row q-gutter-x-lg q-mb-md"},[r("q-field",{staticClass:"col-12",attrs:{icon:"rate_review"}},[r("q-input",{attrs:{name:"description",type:"textarea",rows:"3","stack-label":"",label:"Description",dark:e.LAYOUT.isDark},model:{value:e.rsForm.description,callback:function(t){e.$set(e.rsForm,"description",t)},expression:"rsForm.description"}})],1)],1)])])]),r("q-separator",{attrs:{dark:e.LAYOUT.isDark}}),r("q-card-actions",{staticClass:"q-mx-lg"},[r("q-btn",{attrs:{label:e.$tc("label.cancel"),icon:"cancel",color:"dark"},on:{click:function(t){return e.FORM.toBack()}}}),r("q-btn",{attrs:{label:e.$tc("label.reset"),icon:"refresh",color:"light"},on:{click:function(t){return e.setForm(e.FORM.data)}}}),e.IS_EDITABLE?r("q-btn",{attrs:{label:e.$tc("label.save"),icon:"save",color:"positive"},on:{click:function(t){return e.onSave()}}}):e._e()],1)],1),r("q-inner-loading",{attrs:{visible:e.FORM.loading,dark:e.LAYOUT.isDark}},[r("q-spinner-dots",{attrs:{size:"70px"}})],1)],1):e._e()},s=[],a=(r("551c"),r("097d"),r("7f7f"),r("ac6a"),r("cadf"),r("06db"),r("456d"),r("0ce1")),o={mixins:[a["a"]],data:function(){var e=this;return{SHEET:{customers:{data:[],api:"/api/v1/incomes/customers?mode=all"},brands:{data:[],api:"/api/v1/references/brands?mode=all"},units:{data:[],api:"/api/v1/references/units?mode=all"},vehicles:{data:[],api:"/api/v1/references/vehicles?mode=all"},items:{data:[],api:"/api/v1/common/items?mode=all"}},FORM:{resource:{uri:"/admin/incomes/request-orders",api:"/api/v1/incomes/request-orders"}},rsForm:{},setDefault:function(){return{number:null,begin_date:e.$app.moment().format("YYYY-MM-DD"),until_date:e.$app.moment().format("YYYY-MM-DD"),customer_id:null,date:null,reference_number:null,order_mode:null,description:null,request_order_items:[{id:null,item_id:null,item:{},quantity:null,price:0,unit_id:null,unit_rate:1}]}}}},created:function(){this.init()},computed:{IS_EDITABLE:function(){return!(this.rsForm.hasOwnProperty("has_relationship")&&Object.keys(this.rsForm.has_relationship).length>0)},IssetItemDetails:function(){var e=this.rsForm.request_order_items;for(var t in e)if(e.hasOwnProperty(t)&&e[t].item_id)return!0;return!1},IssetCustomerID:function(){return!!this.rsForm.customer_id},CustomerOptions:function(){var e=this.SHEET.customers.data;return"edit"!==this.$route.meta.mode&&(e=e.filter(function(e){return"PO"===e.order_mode})),e.map(function(e){return{label:[e.code,e.name].join(" - "),value:e.id}})||[]},BrandOptions:function(){return this.SHEET.brands.data.map(function(e){return{label:e.name,value:e.id}})||[]},TransportOptions:function(){return this.SHEET.vehicles.data.map(function(e){return{label:e.name,value:e.id}})||[]},UnitOptions:function(){return this.SHEET.units.data.map(function(e){return{label:e.code,value:e.id}})||[]},ItemOptions:function(){var e=this,t=this.SHEET.items.data.filter(function(t){return t.customer_id===e.rsForm.customer_id}),r=function(e){return null!=e?"No.".concat(e):null};return t.map(function(e){return{label:"[".concat(e.code,"] ").concat(e.part_name),sublabel:r(e.part_number),value:e.id}})||[]},ItemUnitOptions:function(){var e=this,t=[];for(var r in this.rsForm.request_order_items)this.rsForm.request_order_items.hasOwnProperty(r)&&function(){var i=e.rsForm.request_order_items[r];t[r]=e.UnitOptions||[],t[r]=t[r].filter(function(e){if(!i.item_id)return!1;if(i.item){if(i.item.unit_id===e.value)return!0;if(i.item.item_units){var t=i.item.item_units.filter(function(t){return t.unit_id==e.value});if(t.length>0)return!0}}return!1})}();return t},MAPINGKEY:function(){var e={customers:{},units:{},items:{}};return this.SHEET["customers"].data.map(function(t){e["customers"][t.id]=t}),this.SHEET["units"].data.map(function(t){e["units"][t.id]=t}),this.SHEET["items"].data.map(function(t){e["items"][t.id]=t}),e}},watch:{$route:"init"},methods:{init:function(){var e=this;this.SHOW=!1,this.FORM.load(function(t){e.setForm(t),setTimeout(function(){e.SHOW=!0},500)})},setForm:function(e){var t=this;this.rsData=JSON.parse(JSON.stringify(e)),this.rsForm=JSON.parse(JSON.stringify(e)),e.hasOwnProperty("has_relationship")&&Object.keys(e["has_relationship"]).length>0&&this.FORM.response.relationship({title:"Sale Orders has relations!",messages:e["has_relationship"],then:function(){return t.$router.push("".concat(t.FORM.resource.uri,"/").concat(e.id))}})},setCustomerReference:function(e){e?(this.rsForm.customer=this.MAPINGKEY["customers"][e],this.rsForm.order_mode=this.MAPINGKEY["customers"][e].order_mode,"PO"==this.rsForm.order_mode&&(this.rsForm.begin_date,this.rsForm.until_date)):(this.rsForm.customer={},this.rsForm.order_mode=null)},setItemReference:function(e,t){if(t){this.rsForm.request_order_items[e].item=this.MAPINGKEY["items"][t],this.rsForm.request_order_items[e].price=this.MAPINGKEY["items"][t].price;var r=this.MAPINGKEY["items"][t].unit_id;this.rsForm.request_order_items[e].unit_id=r,this.rsForm.request_order_items[e].unit_rate=1,this.rsForm.request_order_items[e].unit=this.MAPINGKEY["units"][r]}else this.rsForm.request_order_items[e].unit_id=null,this.rsForm.request_order_items[e].price=null,this.rsForm.request_order_items[e].unit={},this.rsForm.request_order_items[e].item={}},setUnitReference:function(e,t){var r=this;t&&(this.rsForm.request_order_items[e].item.unit_id===t?this.rsForm.request_order_items[e].unit_rate=1:this.rsForm.request_order_items[e].item.item_units&&this.rsForm.request_order_items[e].item.item_units.map(function(i){i.unit_id==t&&(r.rsForm.request_order_items[e].unit_rate=i.rate)}))},routing:function(){var e=this;if("edit"===this.$route.meta.mode){this.FORM.loading=!0;var t=this.FORM.resource.api+"/"+this.$route.params.id;this.$axios.get(t).then(function(t){var r=t.data;e.setRsForm(r),e.setRsData(r),e.setForm(r)}).catch(function(t){console.warn("[FORM:routing]",t),e.$app.response.error(t.response,"Load Form")}).finally(function(){e.FORM.show=!0,e.FORM.loading=!1})}else this.rsForm=this.setDefault(),this.FORM.show=!0},addNewItem:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e=this.setDefault().request_order_items[0];this.rsForm.request_order_items.push(e)},removeItem:function(e){this.rsForm.request_order_items.splice(e,1),this.rsForm.request_order_items.length<1&&this.addNewItem()},onSave:function(){var e=this;this.$validator.validate().then(function(t){if(t){e.FORM.loading=!0;var r=e.FORM.meta(),i=r.method,s=(r.mode,r.apiUrl);e.$axios.set(i,s,e.rsForm).then(function(t){var r=t.data.number+" - #"+t.data.id;e.FORM.response.success({message:r}),e.FORM.toView(t.data.id)}).catch(function(t){e.FORM.response.error(t.response),e.FORM.response.fields(t.response)}).finally(function(){e.FORM.loading=!1})}else e.$q.notify({color:"negative",icon:"error",position:"top-right",timeout:3e3,message:"Please complete the form fields"})})}}},n=o,l=r("2877"),d=Object(l["a"])(n,i,s,!1,null,null,null);t["default"]=d.exports}}]);