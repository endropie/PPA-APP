(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["2d207d54"],{a1e3:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.SHOW?r("q-page",{staticClass:"main-page justify-center",attrs:{padding:""}},[r("q-card",{staticClass:"q-ma-sm ",attrs:{inline:""}},[r("q-card-section",[r("form-header",{attrs:{title:e.FORM.title(),subtitle:e.FORM.subtitle()}},[r("template",{slot:"menu-item"},[e.$route.params.id?r("list-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:e.$tc("label.remove"),icon:"delete",clickable:""},on:{click:e.FORM.delete}}):e._e()],1)],2)],1),r("q-card-section",[r("div",{staticClass:"row q-gutter-sm q-gutter-x-md"},[r("div",{staticClass:"col-12 col-md-6"},[r("div",{staticClass:"row q-gutter-x-sm q-mb-md"},[r("q-field",{staticClass:"col-12",attrs:{error:e.errors.has("number"),"error-message":e.errors.first("number")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"edit"==e.$route.meta.mode?"required":"",expression:"$route.meta.mode == 'edit' ? 'required':''"}],attrs:{name:"number",label:"No Transaction",placeholder:"[Auto Generate]"},model:{value:e.rsForm.number,callback:function(t){e.$set(e.rsForm,"number",t)},expression:"rsForm.number"}})],1),r("q-field",{staticClass:"col-12",attrs:{error:e.errors.has("customer_id"),"error-message":e.errors.first("customer_id")}},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"customer_id",label:"Customer",options:e.CustomerOptions,filter:"",clearable:""},on:{input:e.setCustomerReference},model:{value:e.rsForm.customer_id,callback:function(t){e.$set(e.rsForm,"customer_id",t)},expression:"rsForm.customer_id"}})],1)],1)]),r("div",{staticClass:"col-12 col-md-6"},[r("div",{staticClass:"row q-gutter-x-sm"},[r("q-field",{staticClass:"col-12"},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"customer_name","stack-label":"",label:"Name"},model:{value:e.rsForm.customer_name,callback:function(t){e.$set(e.rsForm,"customer_name",t)},expression:"rsForm.customer_name"}})],1),r("q-field",{staticClass:"col-12"},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"customer_phone","stack-label":"",label:"phone"},model:{value:e.rsForm.customer_phone,callback:function(t){e.$set(e.rsForm,"customer_phone",t)},expression:"rsForm.customer_phone"}})],1),r("q-field",{staticClass:"col-12"},[r("q-input",{attrs:{name:"customer_address","stack-label":"",label:"Address",type:"textarea",rows:"2"},model:{value:e.rsForm.customer_address,callback:function(t){e.$set(e.rsForm,"customer_address",t)},expression:"rsForm.customer_address"}})],1)],1)]),e.ShipDeliveryItemOptions.length>0?r("div",{staticClass:"col-12 q-my-md"},[r("q-table",{ref:"table",staticClass:"table d-grid full-width shadow-1",attrs:{data:e.rsForm.ship_delivery_items,dense:"","hide-bottom":"","rows-per-page-options":[0],columns:[{name:"prefix",label:"",field:"id",align:"left"},{name:"code",label:"#code",align:"left",field:function(e){return e.item.code},style:"padding:10px 7px"},{name:"item_id",label:"Part item",align:"left",field:function(e){return e.item.part_name}},{name:"quantity",label:"Quantity",align:"center",field:"quantity"},{name:"unit_id",label:"unit",align:"center",field:function(e){return e.unit.name}}],pagination:{rowsPerPage:0}}})],1):e._e(),r("div",{staticClass:"col-12"},[r("div",{staticClass:"row q-gutter-x-sm q-mb-md"},[r("q-field",{staticClass:"col-12",attrs:{error:e.errors.has("operator_id"),"error-message":e.errors.first("operator_id")}},[r("q-select",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"operator_id","stack-label":"",label:"Operator",options:e.OperatorOptions},model:{value:e.rsForm.operator_id,callback:function(t){e.$set(e.rsForm,"operator_id",t)},expression:"rsForm.operator_id"}})],1),r("q-field",{staticClass:"col-12 col-sm-8 col-md-4",attrs:{error:e.errors.has("date"),"error-message":e.errors.first("date")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"date","stack-label":"",label:"Date",type:"date"},model:{value:e.rsForm.date,callback:function(t){e.$set(e.rsForm,"date",t)},expression:"rsForm.date"}})],1),r("q-field",{staticClass:"col-12 col-sm-4 col-md-2",attrs:{error:e.errors.has("time"),"error-message":e.errors.first("time")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"time","stack-label":"",label:"Time",type:"time"},model:{value:e.rsForm.time,callback:function(t){e.$set(e.rsForm,"time",t)},expression:"rsForm.time"}})],1),r("q-field",{staticClass:"col-12 col-sm-8 col-md-4",attrs:{error:e.errors.has("due_date"),"error-message":e.errors.first("due_date")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"due_date","stack-label":"",label:"Due Date",type:"date"},model:{value:e.rsForm.due_date,callback:function(t){e.$set(e.rsForm,"due_date",t)},expression:"rsForm.due_date"}})],1),r("q-field",{staticClass:"col-12 col-sm-4 col-md-2",attrs:{error:e.errors.has("due_time"),"error-message":e.errors.first("due_time")}},[r("q-input",{directives:[{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],attrs:{name:"due_time","stack-label":"",label:"Due Time",type:"time"},model:{value:e.rsForm.due_time,callback:function(t){e.$set(e.rsForm,"due_time",t)},expression:"rsForm.due_time"}})],1),r("q-field",{staticClass:"col-12",attrs:{icon:"rate_review"}},[r("q-input",{attrs:{name:"description",type:"textarea",rows:"3","stack-label":"",label:"Description"},model:{value:e.rsForm.description,callback:function(t){e.$set(e.rsForm,"description",t)},expression:"rsForm.description"}})],1)],1)])])]),r("q-separator",{attrs:{dark:e.LAYOUT.isDark}}),r("q-card-actions",{staticClass:"q-mx-lg"},[r("q-btn",{attrs:{label:e.$tc("label.cancel"),icon:"cancel",color:"dark"},on:{click:function(t){return e.FORM.toBack()}}}),r("q-btn",{attrs:{label:e.$tc("label.reset"),icon:"refresh",color:"light"},on:{click:function(t){return e.setForm(e.FORM.data)}}}),e.IS_EDITABLE?r("q-btn",{attrs:{label:e.$tc("label.save"),icon:"save",color:"positive"},on:{click:function(t){return e.onSave()}}}):e._e()],1)],1),r("q-inner-loading",{attrs:{visible:e.FORM.loading,dark:e.LAYOUT.isDark}},[r("q-spinner-dots",{attrs:{size:"70px",color:"primary"}})],1)],1):e._e()},i=[],a=(r("551c"),r("097d"),r("7f7f"),r("ac6a"),r("cadf"),r("06db"),r("456d"),r("0ce1")),o={mixins:[a["a"]],data:function(){var e=this;return{SHEET:{ship_delivery_items:{autoload:!1,api:"/api/v1/incomes/ship-delivery-items?mode=all&--scope=wait"},customers:{data:[],api:"/api/v1/incomes/customers?mode=all"},operators:{data:[],api:"/api/v1/references/operators?mode=all"},vehicles:{data:[],api:"/api/v1/references/vehicles?mode=all"},units:{data:[],api:"/api/v1/references/units?mode=all"},items:{data:[],api:"/api/v1/common/items?mode=all"}},FORM:{resource:{api:"/api/v1/incomes/ship-deliveries",uri:"/admin/incomes/delivery/ship-deliveries"}},rsForm:{},setDefault:function(){return{number:null,date:e.$app.moment().format("YYYY-MM-DD"),time:e.$app.moment().format("HH:mm"),customer_id:null,customer_name:null,customer_phone:null,customer_address:null,operator_id:null,transport_number:null,transport_rate:null,due_date:e.$app.moment().format("YYYY-MM-DD"),due_time:e.$app.moment().format("HH:mm"),description:null,revise_id:0,ship_delivery_items:[]}}}},created:function(){this.init()},computed:{IS_EDITABLE:function(){return(!this.rsForm.hasOwnProperty("revise_id")||1!=this.rsForm.is_revision)&&!(this.rsForm.hasOwnProperty("has_relationship")&&Object.keys(this.rsForm.has_relationship).length>0)},ShipDeliveryItemOptions:function(){if(!this.rsForm.customer_id)return[];var e=this.SHEET["ship_delivery_items"].data.slice();return this.rsForm.ship_delivery_items=e,e},CustomerOptions:function(){return this.SHEET.customers.data.map(function(e){return{label:[e.code,e.name].join(" - "),value:e.id}})||[]},TransportOptions:function(){return this.SHEET.vehicles.data.map(function(e){return{label:e.name,value:e.name}})},OperatorOptions:function(){return this.SHEET.operators.data.map(function(e){return{label:e.name,value:e.id}})||[]},VehicleOptions:function(){return this.SHEET.vehicles.data.map(function(e){return{label:e.name,value:e.id}})||[]},UnitOptions:function(){return this.SHEET.units.data.map(function(e){return{label:e.code,value:e.id}})||[]},ItemOptions:function(){var e=this,t=this.SHEET.items.data.filter(function(t){return t.customer_id===e.rsForm.customer_id});return t.map(function(e){return{label:"".concat(e.code," - ").concat(e.part_name),value:e.id}})||[]},ItemUnitOptions:function(){var e=this,t=[];for(var r in this.rsForm.ship_delivery_items)this.rsForm.ship_delivery_items.hasOwnProperty(r)&&function(){var s=e.rsForm.ship_delivery_items[r];t[r]=e.UnitOptions||[],t[r]=t[r].filter(function(e){if(!s.item_id)return!1;if(s.item){if(s.item.unit_id===e.value)return!0;if(s.item.item_units){var t=s.item.item_units.filter(function(t){return t.unit_id==e.value});if(t.length>0)return!0}}return!1})}();return t},MAPINGKEY:function(){var e={customers:{},units:{},items:{}};return this.SHEET["customers"].data.map(function(t){e["customers"][t.id]=t}),this.SHEET["units"].data.map(function(t){e["units"][t.id]=t}),this.SHEET["items"].data.map(function(t){e["items"][t.id]=t}),e}},watch:{$route:"init"},methods:{init:function(){var e=this;this.SHOW=!1,this.FORM.load(function(t){e.setForm(t),setTimeout(function(){e.SHOW=!0},500)})},setCustomerReference:function(e){this.rsForm.customer_id?(this.rsForm.customer_name=this.MAPINGKEY["customers"][e].name,this.rsForm.customer_phone=this.MAPINGKEY["customers"][e].phone,this.rsForm.customer_address=this.MAPINGKEY["customers"][e].address_raw,this.SHEET.load("ship_delivery_items","customer_id="+e)):(this.rsForm.customer_name=null,this.rsForm.customer_phone=null,this.rsForm.customer_address=null)},setForm:function(e){var t=this;this.rsData=JSON.parse(JSON.stringify(e)),this.rsForm=JSON.parse(JSON.stringify(e)),e.hasOwnProperty("has_relationship")&&Object.keys(e["has_relationship"]).length>0&&this.FORM.response.relationship({title:"Ship-Delivery has relations!",messages:e["has_relationship"],then:function(){return t.$router.push("".concat(t.FORM.resource.uri,"/").concat(e.id))}})},addNewItem:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e=this.setDefault().ship_delivery_items[0];this.rsForm.ship_delivery_items.push(e)},removeItem:function(e){this.rsForm.ship_delivery_items.splice(e,1)},onSave:function(){var e=this;this.$validator.validate().then(function(t){if(t){e.FORM.loading=!0;var r=e.FORM.meta(),s=r.method,i=(r.mode,r.apiUrl);e.$axios.set(s,i,e.rsForm).then(function(t){var r=t.data.number+" - #"+t.data.id;e.FORM.response.success({message:r}),e.FORM.toView(t.data.id)}).catch(function(t){console.warn("SAVE-ERROR",t.response),e.FORM.response.fields(t.response),e.FORM.response.error(t.response,"Submit")}).finally(function(){e.FORM.loading=!1})}else e.$q.notify({color:"negative",icon:"error",position:"top-right",timeout:3e3,message:"Please complete the form fields"})})}}},n=o,l=r("2877"),m=Object(l["a"])(n,s,i,!1,null,null,null);t["default"]=m.exports}}]);